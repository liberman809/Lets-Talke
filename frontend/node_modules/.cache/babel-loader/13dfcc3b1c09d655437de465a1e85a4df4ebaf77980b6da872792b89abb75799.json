{"ast":null,"code":"import { io } from \"socket.io-client\";\nimport { addMsg } from \"./chatActions\";\nimport { updateUserChats } from \"./userActions\";\nlet socket = null;\nexport async function initSocket() {\n  try {\n    // שליחת פינג לשרת לבדוק אם הוא חי\n    const res = await fetch(\"http://localhost:3030/api/ping\", {\n      credentials: 'include'\n    });\n    if (res.ok) {\n      // שרת חי – מתחברים לסוקטים\n      socket = io(\"http://localhost:3030\", {\n        withCredentials: true,\n        transports: [\"polling\", \"websocket\"]\n      });\n      socket.on(\"connect\", () => {\n        console.log(\"Connected to WebSocket:\", socket.id);\n      });\n      socket.on(\"newMsg\", function (data) {\n        addMsg(data);\n      });\n      socket.on(\"addUser\", function (id) {\n        updateUserChats(id);\n      });\n      socket.on(\"connect_error\", err => {\n        console.error(\"Socket connection error:\", err);\n      });\n    } else {\n      console.log(\"Server not ready yet.\");\n    }\n  } catch (err) {\n    console.error(\"Failed to reach server:\", err);\n  }\n  console.log('a');\n  return socket;\n}\nexport function listen(userId) {\n  if (socket) socket.emit(\"listen\", userId);\n}\nexport function joinChat(chatId) {\n  if (socket) socket.emit(\"chat\", chatId);\n}\nexport function socketNewMsg(chatId) {\n  if (socket) socket.emit(\"newMsg\", chatId);\n}\nexport function socketAddUser(userId) {\n  if (socket) socket.emit(\"addUser\", userId);\n}","map":{"version":3,"names":["io","addMsg","updateUserChats","socket","initSocket","res","fetch","credentials","ok","withCredentials","transports","on","console","log","id","data","err","error","listen","userId","emit","joinChat","chatId","socketNewMsg","socketAddUser"],"sources":["C:/Users/ASUS/Desktop/projects/lets talke/frontend/src/store/socket.js"],"sourcesContent":["import { io } from \"socket.io-client\";\r\nimport { addMsg } from \"./chatActions\";\r\nimport { updateUserChats } from \"./userActions\";\r\n\r\nlet socket = null;\r\n\r\nexport async function initSocket() {\r\n  try {\r\n    // שליחת פינג לשרת לבדוק אם הוא חי\r\n    const res = await fetch(\"http://localhost:3030/api/ping\", { credentials: 'include' });\r\n\r\n    if (res.ok) {\r\n      // שרת חי – מתחברים לסוקטים\r\n      socket = io(\"http://localhost:3030\", {\r\n        withCredentials: true,\r\n        transports: [\"polling\", \"websocket\"],\r\n      });\r\n\r\n      socket.on(\"connect\", () => {\r\n        console.log(\"Connected to WebSocket:\", socket.id);\r\n      });\r\n\r\n      socket.on(\"newMsg\", function (data) {\r\n        addMsg(data);\r\n      });\r\n\r\n      socket.on(\"addUser\", function (id) {\r\n        updateUserChats(id);\r\n      });\r\n\r\n      socket.on(\"connect_error\", (err) => {\r\n        console.error(\"Socket connection error:\", err);\r\n      });\r\n    } else {\r\n      console.log(\"Server not ready yet.\");\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Failed to reach server:\", err);\r\n  }\r\n\r\n  console.log('a')\r\n  return socket;\r\n}\r\n\r\nexport function listen(userId) {\r\n  if (socket) socket.emit(\"listen\", userId);\r\n}\r\n\r\nexport function joinChat(chatId) {\r\n  if (socket) socket.emit(\"chat\", chatId);\r\n}\r\n\r\nexport function socketNewMsg(chatId) {\r\n  if (socket) socket.emit(\"newMsg\", chatId);\r\n}\r\n\r\nexport function socketAddUser(userId) {\r\n  if (socket) socket.emit(\"addUser\", userId);\r\n}\r\n"],"mappings":"AAAA,SAASA,EAAE,QAAQ,kBAAkB;AACrC,SAASC,MAAM,QAAQ,eAAe;AACtC,SAASC,eAAe,QAAQ,eAAe;AAE/C,IAAIC,MAAM,GAAG,IAAI;AAEjB,OAAO,eAAeC,UAAUA,CAAA,EAAG;EACjC,IAAI;IACF;IACA,MAAMC,GAAG,GAAG,MAAMC,KAAK,CAAC,gCAAgC,EAAE;MAAEC,WAAW,EAAE;IAAU,CAAC,CAAC;IAErF,IAAIF,GAAG,CAACG,EAAE,EAAE;MACV;MACAL,MAAM,GAAGH,EAAE,CAAC,uBAAuB,EAAE;QACnCS,eAAe,EAAE,IAAI;QACrBC,UAAU,EAAE,CAAC,SAAS,EAAE,WAAW;MACrC,CAAC,CAAC;MAEFP,MAAM,CAACQ,EAAE,CAAC,SAAS,EAAE,MAAM;QACzBC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAEV,MAAM,CAACW,EAAE,CAAC;MACnD,CAAC,CAAC;MAEFX,MAAM,CAACQ,EAAE,CAAC,QAAQ,EAAE,UAAUI,IAAI,EAAE;QAClCd,MAAM,CAACc,IAAI,CAAC;MACd,CAAC,CAAC;MAEFZ,MAAM,CAACQ,EAAE,CAAC,SAAS,EAAE,UAAUG,EAAE,EAAE;QACjCZ,eAAe,CAACY,EAAE,CAAC;MACrB,CAAC,CAAC;MAEFX,MAAM,CAACQ,EAAE,CAAC,eAAe,EAAGK,GAAG,IAAK;QAClCJ,OAAO,CAACK,KAAK,CAAC,0BAA0B,EAAED,GAAG,CAAC;MAChD,CAAC,CAAC;IACJ,CAAC,MAAM;MACLJ,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC;IACtC;EACF,CAAC,CAAC,OAAOG,GAAG,EAAE;IACZJ,OAAO,CAACK,KAAK,CAAC,yBAAyB,EAAED,GAAG,CAAC;EAC/C;EAEAJ,OAAO,CAACC,GAAG,CAAC,GAAG,CAAC;EAChB,OAAOV,MAAM;AACf;AAEA,OAAO,SAASe,MAAMA,CAACC,MAAM,EAAE;EAC7B,IAAIhB,MAAM,EAAEA,MAAM,CAACiB,IAAI,CAAC,QAAQ,EAAED,MAAM,CAAC;AAC3C;AAEA,OAAO,SAASE,QAAQA,CAACC,MAAM,EAAE;EAC/B,IAAInB,MAAM,EAAEA,MAAM,CAACiB,IAAI,CAAC,MAAM,EAAEE,MAAM,CAAC;AACzC;AAEA,OAAO,SAASC,YAAYA,CAACD,MAAM,EAAE;EACnC,IAAInB,MAAM,EAAEA,MAAM,CAACiB,IAAI,CAAC,QAAQ,EAAEE,MAAM,CAAC;AAC3C;AAEA,OAAO,SAASE,aAAaA,CAACL,MAAM,EAAE;EACpC,IAAIhB,MAAM,EAAEA,MAAM,CAACiB,IAAI,CAAC,SAAS,EAAED,MAAM,CAAC;AAC5C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}